/*! BEGIN Saving */

(function(){'dont use strict';var a={};global.tab=global.tab||{};ss.initAssembly(a,'vqlsaving');var b=global.tab.ContainerRowTemplate=ss.mkType(a,'tab.ContainerRowTemplate',function(){this.container=null;spiff.Template.call(this,$("\n<tr>\n  <td>\n    <div class='tabAuthSaveContainer'></div>\n  </td>\n</tr>"));this.container=this.getElementBySelector('.tabAuthSaveContainer');});var c=global.tab.ISaveStrategy=ss.mkType(a,'tab.ISaveStrategy');var d=global.tab.NameInputTemplate=ss.mkType(a,'tab.NameInputTemplate',function(){this.nameDom=null;spiff.Template.call(this,$("\n<tr>\n  <td>\n    <div class='tabAuthSaveNameRowValue'>\n      <input class='tabAuthSaveTextInput' type='text' tabindex='0'/>\n    </div>\n  </td>\n</tr>"));this.nameDom=this.getElementBySelector('.tabAuthSaveTextInput');});var e=global.tab.NameLabelTemplate=ss.mkType(a,'tab.NameLabelTemplate',function(){this.label=null;spiff.Template.call(this,$("\n<tr>\n  <td>\n    <div class='tabAuthSaveLabel tabAuthSaveLabelName'></div>\n  </td>\n</tr>"));this.label=this.getElementBySelector('.tabAuthSaveLabel');});var f=global.tab.PersonalSpace=ss.mkType(a,'tab.PersonalSpace',function(D,E,F){this.$1$1=null;this.$1$2=null;this.$1$3=false;this.set_luid(D);this.set_ownerLuid(E);this.set_readOnly(F);},{get_luid:function(){return this.$1$1;},set_luid:function(D){this.$1$1=D;},get_ownerLuid:function(){return this.$1$2;},set_ownerLuid:function(D){this.$1$2=D;},get_readOnly:function(){return this.$1$3;},set_readOnly:function(D){this.$1$3=D;}});var g=global.tab.PersonalSpaceComponent=ss.mkType(a,'tab.PersonalSpaceComponent',function(D){React.PureComponent.call(this,D);},{$0:function(){var D={className:'tab-personalSpaceUrl',href:this.props.personalSpaceUrl,target:'_blank',testId:'PersonalSpaceUrl',children:this.props.personalSpaceText};return React.createElement(SharedWidgets.TextLinkWidget,D);},render:function(){var D=[g.$1(),this.$0()];return g.$0(D);}},{$1:function(){return spiff.DOMElements.span({style:g.$4},tab.Strings.AuthSaveLabelSaveTo);},$0:function(D){return spiff.DOMElements.div({style:g.$3},D);}});var h=global.tab.PersonalSpaceViewModel=ss.mkType(a,'tab.PersonalSpaceViewModel',function(){this.$3=null;ss.makeGenericType(spiff.BaseReactViewModel$1,[Object]).call(this);this.$3=tab.URIUtil.get_personalSpaceUri();},{createUpdatedProps:function(){return {personalSpaceText:tab.Strings.AuthSavePersonalSpaceTitle,personalSpaceUrl:this.$3};}});var i=global.tab.ProjectLabelTemplate=ss.mkType(a,'tab.ProjectLabelTemplate',function(){this.label=null;this.tableData=null;spiff.Template.call(this,$("\n<tr>\n  <td class='tabAuthSaveTableData'>\n    <div class='tabAuthSaveLabel tabAuthSaveLabelDestination'></div>\n  </td>\n</tr>"));this.label=this.getElementBySelector('.tabAuthSaveLabel');this.tableData=this.getElementBySelector('.tabAuthSaveTableData');});var j=global.tab.ProjectPickerComponent=ss.mkType(a,'tab.ProjectPickerComponent',function(D){ss.makeGenericType(tab.PureComponentWithAsyncDependencies$3,[Object,Object,Object]).call(this,D);},{fetchAsyncDependencies:function(){return tab.ModuleManager.load('nested-project-explorer',[]).pipe(function(D){return D;});},renderWhileWaiting:function(){return j.$1();},renderWithDependencies:function(D){if(ss.isNullOrUndefined(this.props.projects)){return j.$1();}var E=D.NestedItemsTreeHelper.convertItemListToTrees(this.props.projects);var F={topLevelDestinationStatus:this.props.topLevelDestinationStatus,projects:E,initiallySelectedProjectId:this.props.initiallySelectedProjectId,onSelectedProjectChanged:this.props.onSelectedItemChanged,showSearchField:true};return j.$0(spiff.DOMElements.div({style:j.$4},React.createElement(D.NestedProjectExplorer,F)));}},{$0:function(D){return spiff.DOMElements.div({className:'projectPickerContainer',style:j.$3},D);},$1:function(){return j.$0(spiff.DOMElements.div({className:'tab-fill-centered'},React.createElement(SharedWidgets.ActivitySpinnerWidget,{})));}});var k=global.tab.ProjectPickerViewModel=ss.mkType(a,'tab.ProjectPickerViewModel',function(D,E){this.$5=null;this.$3=null;this.$4=null;this.getDestinationProjects=null;this.personalSpaceDeferred=null;ss.makeGenericType(spiff.BaseReactViewModel$1,[Object]).call(this);this.$5=D;this.personalSpaceDeferred=E;var F=ss.mkdel(this,function(G,H){this.$3=G;this.$4=H;});this.getDestinationProjects=tab.WorkgroupServerCommands.getDestinationProjects('workbook',null);this.getDestinationProjects.done(ss.mkdel(this,function(G){k.handleProjects(G,this.$3,this.$4,F);})).done(ss.mkdel(this,function(){if(ss.isValue(E)){E.done(ss.mkdel(this,function(G){k.handlePersonalSpace(G,this.$3,this.$4,F);})).done(ss.mkdel(this,function(){k.updateSelectedLocationAndIncrementProps(this.$4,this.$5,ss.mkdel(this,this.incrementProps));}));}else{k.updateSelectedLocationAndIncrementProps(this.$4,this.$5,ss.mkdel(this,this.incrementProps));}}));},{createInitialProps:function(){return {onSelectedItemChanged:ss.mkdel(this,function(D){var E=this.$5;var F;if(ss.isValue(D)){var G=new Object();G.id=D.id;G.name=D.name;G.locationType=(ss.isNullOrUndefined(D.itemType)?'PROJECT':D.itemType.toUpperCase());F=G;}else{F=null;}E(F);})};},createUpdatedProps:function(){var D=(ss.isValue(this.$4)?this.$4.id:null);return {projects:this.$3,topLevelDestinationStatus:'structurally_invalid',initiallySelectedProjectId:D};}},{updateSelectedLocationAndIncrementProps:function(D,E,F){E(D);F();},handleProjects:function(D,E,F,G){F={$:F};var H={};_.each(D,function(I){H[I.id.toString()]=I;});E=k.$0(D);if(tab.MiscUtil.isNullOrEmpty$1(tab.CurrentLocation.get_locationType())||tab.CurrentLocation.get_isLocationProject()){k.handleInitialProjectSelection(D,H,F);}G(E,F.$);},$0:function(D){return _.map(D,ss.mkdel(this,function(E){return {id:E.id.toString(),name:E.name,parentId:E.parentProjectId,childItemCount:E.childProjectCount,topLevelItem:E.topLevelProject,controlledPermissionsEnabled:E.controlledPermissionsEnabled,status:E.status};}));},handleInitialProjectSelection:function(D,E,F){if(tabBootstrap.Affordances.isOff('authoring_SaveDialog_ShowOptions')){return;}var G=tsConfig.current_project_id.toString();var H=null;if(ss.keyExists(E,G)){H=E[G];}if(ss.isNullOrUndefined(H)){H=_.find(D,function(J){return J.isDefaultProject;});}if(ss.isNullOrUndefined(H)&&ss.getKeyCount(E)===1){H=_.find(D,function(J){return true;});}if(ss.isValue(H)){if(H.status==='valid'){var I=new Object();I.id=H.id.toString();I.name=H.name;I.locationType='PROJECT';F.$=I;}}},handlePersonalSpace:function(D,E,F,G){if(ss.isNullOrUndefined(D)){return;}var H={id:D.luid,name:'Personal Space',childItemCount:0,topLevelItem:true,status:'valid',itemType:'personal_space',controlledPermissionsEnabled:true};var I=E.slice(0);I.push(H);E=I;if(tab.CurrentLocation.get_isLocationPersonalSpace()){var J=new Object();J.id=H.id.toString();J.name=H.name;J.locationType=tab.CurrentLocation.get_locationType();F=J;}G(E,F);}});var l=global.tab.SaveAskDataStrategy=ss.mkType(a,'tab.SaveAskDataStrategy',function(D,E,F){this.$6=null;x.call(this,D,E,F);this.$6=D;this.set_InitialName('');},{initiateSave:function(D){switch(this.$6){case 'save':{if(ss.isNullOrUndefined(l.$2)||l.$3===''){D.cancelled();break;}D.set_currentLocation(l.$2);D.set_workbookName(l.$3);D.saveWithoutConfirmingOverwrite();break;}case 'saveAs':{D.add_saveSucceeded(l.$0(D));tab.ObjectRegistry.newView(t).call(null,[D]);D.showSave();break;}}},constructSuccessHandler:function(D){return (ss.staticEquals(D,null)?z.createSessionReloadAction():D);}},{$0:function(D){return function(E){l.$2=D.get_currentLocation();l.$3=D.get_workbookName();};}});var m=global.tab.SaveController=ss.mkType(a,'tab.SaveController',function(){this.$1$1=false;this.$1$2=null;this.$1$3=null;this.set_strategyFactory(new s());},{get_hasUnusedFiles:function(){return this.$1$1;},$0:function(D){this.$1$1=D;},get_strategyFactory:function(){return this.$1$2;},set_strategyFactory:function(D){this.$1$2=D;},get_publishedToastId:function(){return this.$1$3;},set_publishedToastId:function(D){this.$1$3=D;},saveWorkbook:function(D,E){if(tsConfig.is_guest){this.$1();}else if(!m.$0()){if(!ss.staticEquals(E,null)){E();}}else if(tab.SavingUtil.isSaveEnabled()){this.$4(D);}else if(tab.SavingUtil.isSaveAsEnabled()){this.$5('save',D,E);}},saveWorkbookAs:function(D,E){if(tsConfig.is_guest){this.$1();}else if(!m.$0()){if(!ss.staticEquals(E,null)){E();}}else if(tab.SavingUtil.isSaveAsEnabled()){this.$5('saveAs',D,E);}},$4:function(D){this.checkUnusedFiles(ss.mkdel(this,function(){tab.DataSourceExtractController.commitPendingExtractAction().done(ss.mkdel(this,function(){this.$2(D);}));}));},$5:function(D,E,F){this.checkUnusedFiles(ss.mkdel(this,function(){tab.DataSourceExtractController.commitPendingExtractAction().then(ss.mkdel(this,function(){this.$3(D,E,F);}),function(){if(!ss.staticEquals(F,null)){F();}});}));},$9:function(){if(tsConfig.embeddingV3){return;}if(tsConfig.isPublic){this.$8(false);}else{this.$8(true);}},$8:function(D){var E=tab.Strings.AuthoringToastMessagePublishedWorkbook(tsConfig.workbookName);var F=tab.Strings.AuthoringToastActionMessageGoToWorkbook;var G=tab.URIUtil.get_workbookViewsUri();if(ss.isValue(this.get_publishedToastId())){SharedWidgets.ToastWidget.dismiss(this.get_publishedToastId());}if(D){this.set_publishedToastId(SharedWidgets.ToastWidget.show({message:E,toastType:'success',actionMessage:F,actionHref:G,onCloseRequest:ss.mkdel(this,function(){this.set_publishedToastId(null);})}));}else{this.set_publishedToastId(SharedWidgets.ToastWidget.show({message:E,toastType:'success',onCloseRequest:ss.mkdel(this,function(){this.set_publishedToastId(null);})}));}},$a:function(){tab.NotificationViewModel.showNotification(tab.Strings.UnusedFilesInSaveWorkbookPublishedMessage,null);this.$9();},$7:function(){tab.NotificationViewModel.showNotification(tab.Strings.UnusedFilesInSaveWorkbookPublishedMessage,null);},$2:function(D){var E=$.Deferred();tab.SaveServerCommands.saveWorkbook(ss.mkdel(this,function(F){E.resolve(F);if(ss.isValue(D)){D(F);if(this.get_hasUnusedFiles()){this.$7();}this.$9();}else{this.$a();}tab.ApplicationModel.get_instance().raiseNotification('doc:workbook-published-event',null,null);}));this.$6();return E.promise();},$3:function(D,E,F){if(this.get_hasUnusedFiles()){tab.NotificationViewModel.showNotification(tab.Strings.UnusedFilesInSaveWorkbookPublishedMessage,null);}var G=ss.mkdel(this,function(I){this.get_strategyFactory().create(D,E,I).done(ss.mkdel(this,function(J){var K=new u.$ctor2(J,J.get_successHandler(),F);var L=ss.mkdel(this,function(M){this.$6();});K.add_saveSucceeded(L);J.initiateSave(K);}));});if(tabBootstrap.FeatureFlags.isEnabled('VConnDownstreamExtractsWithWarnings')){tab.SchemaClientCommands.getHasUserSpecificExtract().done(G);}else{var H=false;G(H);}},$1:function(){var D=tab.VizUriModel.createForCurrentWindowLocationAndVizState(tsConfig.repositoryUrl,tsConfig.current_sheet_name);D.set_showSaveAs(true);tab.LogOnViewModel.logOnAndTransitionSession(D);},checkUnusedFiles:function(D){if(tabBootstrap.Affordances.isOn('authoring_DataTab')){tab.SchemaClientCommands.getHasUnusedFiles(ss.mkdel(this,function(E){this.$0(E);D();}));}else{this.$0(false);D();}},$6:function(){if(tsConfig.is_authoring){tab.AutoSaveController.get_instance().publishInitiated();}},onlyForTest_ClearPublishedToast:function(){SharedWidgets.ToastWidget.dismiss(m.get_instance().get_publishedToastId());}},{get_instance:function(){if(ss.isNullOrUndefined(m.$1)){m.$1=new m();}return m.$1;},get_logger:function(){return tab.Logger.getLogger(m,null);},$0:function(){if(tab.ApplicationModel.get_instance().get_workbook().get_hasPublishedSheets()){return true;}var D=tab.ConfirmationViewModel.create(ss.htmlEncode(tab.Strings.SaveNoPublishedSheetsBody),function(E){});D.set_titleText(tab.Strings.SaveNoPublishedSheetsTitle);D.set_showDenyButton(false);D.set_confirmText(tab.Strings.DialogButtonOK);D.show();return false;}});var n=global.tab.SaveDialogAccessHeader=ss.mkType(a,'tab.SaveDialogAccessHeader',function(){React.Component.call(this);},{render:function(){return w.$0({},w.$2({},spiff.DOMElements.p({className:'tabAuthWorkbookAccessHeader'},tab.Strings.AuthSaveWorkbookAccessHeaderSimple)));}});var o=global.tab.SaveDialogButtonGroup=ss.mkType(a,'tab.SaveDialogButtonGroup',function(){React.Component.call(this);},{render:function(){return w.$0({className:'tabAuthSaveButtons'},[(!tab.NaturalLanguageUtil.isNlpView()?ss.mkdel(this,function(){return w.createAnalyzeWorkbookButton(this.props.analyzeWorkbookButtonClicked);})():null),w.createDivWithKey('tabAuthFlexDiv',['']),w.createCancelButton(this.props.cancelButtonClicked),w.createSaveButton(this.props.saveDialogAction,this.props.saveButtonEnabled)]);}});var p=global.tab.SaveDialogButtonGroupProps=ss.mkType(a,'tab.SaveDialogButtonGroupProps',function(D,E,F,G){this.saveDialogAction=null;this.saveButtonEnabled=false;this.cancelButtonClicked=null;this.analyzeWorkbookButtonClicked=null;this.saveDialogAction=D;this.saveButtonEnabled=E;this.cancelButtonClicked=F;this.analyzeWorkbookButtonClicked=G;});var q=global.tab.SaveDialogEmbedWarning=ss.mkType(a,'tab.SaveDialogEmbedWarning',function(){React.Component.call(this);},{render:function(){return w.$0({},w.$2({className:'tabAuthWarningGroup'},[w.$2({},[w.$2({className:'tab-icons-dialog-status-warning tabAuthWarningIcon'}),w.$1({className:'tabAuthWarningHeader'},tab.Strings.WarningTitle)]),w.$1({className:'tabAuthWarningMessage'},tab.Strings.WorkbookAccessWarningBody)]));}});var r=global.tab.SaveDialogUserSpecificExtractWarning=ss.mkType(a,'tab.SaveDialogUserSpecificExtractWarning',function(){React.Component.call(this);},{render:function(){var D=spiff.DOMElements.span({},tab.Strings.WorkbookPublishDialogUserSpecificExtractWarning);return React.createElement(SharedWidgets.CompactInlineAlertWidget,{testId:r.$1,style:{marginTop:'12px'},children:D,type:'warning'});}});var s=global.tab.SaveStrategyFactory=ss.mkType(a,'tab.SaveStrategyFactory',function(){},{create:function(D,E,F){var G=$.Deferred();if(tab.NaturalLanguageUtil.isNlpView()){G.resolve(new l(D,E,F));return G;}G.resolve(new x(D,E,F));return G;}});var t=global.tab.SaveView=ss.mkType(a,'tab.SaveView',function(D){this.$t=null;this.$x=null;this.$u=null;this.$z=null;this.$y=null;this.$A=null;this.$v=null;this.$w=null;ss.makeGenericType(spiff.BaseView$1,[u]).call(this,D,spiff.Template.fromHtml("<div class='tabAuthSaveWBO'></div>"));this.$t=D;this.$t.add_shown(ss.mkdel(this,this.$s));this.$t.add_hidden(ss.mkdel(this,this.$e));this.buildDom();this.updateContent();this.enableTextSelection();},{dispose:function(){this.$t.remove_shown(ss.mkdel(this,this.$s));this.$t.remove_hidden(ss.mkdel(this,this.$e));if(ss.isValue(this.$A)){this.$A.dispose();}if(ss.isValue(this.$v)){this.$v.dispose();}if(ss.isValue(this.$w)){this.$w.dispose();}ss.makeGenericType(spiff.BaseView$1,[u]).prototype.dispose.call(this);},onViewModelPropertyChanged:function(D,E){this.updateContent();},updateContent:function(){if(!ss.referenceEquals(this.$x.val(),this.$t.get_workbookName())){this.$x.val(this.$t.get_workbookName());}if(ss.isValue(this.$A)){this.$A.set_selected(this.$t.get_showTabs());}this.$m();},buildDom:function(){this.element.attr('tabindex','-1');var D=new d();this.$x=D.nameDom;spiff.Widget.enableTextSelectionOnElement(this.$x);if(!this.$t.get_isSaveExistingWorkbook()){var E=$('<table></table>').addClass('tabAuthSaveLayoutTable');var F=this.$h().domRoot;var G=D.domRoot;E.append(F).append(G);if(tabBootstrap.Affordances.isOn('authoring_SaveDialog_ShowOptions')){this.$p(E);this.$q(E);}this.element.append(E);}this.$u=$('<div></div>');this.element.append(this.$u);},$q:function(D){if(this.$t.get_supportsTabs()){this.$A=this.$9(ss.mkdel(this,this.$r),tab.Strings.AuthSaveLabelShowTabs,'tabAuthSaveShowTabsCheck');var E=this.$k();D.append(E.domRoot);}},$p:function(D){if(tsConfig.allow_personal_space_only){this.$y=tab.ObjectRegistry.newView(ss.makeGenericType(spiff.ReactHostView$3,[h,g,Object])).call(null,[this.$t.get_personalSpaceViewModel()]);var E=this.$g('tabAuthSavePersonalSpace');var F=E.container;this.$y.addToDom(F);var G=E.domRoot;D.append(G);}else{this.$z=tab.ObjectRegistry.newView(ss.makeGenericType(spiff.ReactHostView$3,[k,j,Object])).call(null,[this.$t.get_projectPickerViewModel()]);if(ss.isValue(this.$t.get_saveWarning())){var H=this.$j();this.element.append(H.domRoot);}var I=this.$f(this.$i().domRoot);var J=this.$g('tabAuthSaveProjectPicker');var K=J.container;this.$z.addToDom(K);var L=this.$f(J.domRoot);D.append(I).append(L);}},$9:function(D,E,F){var G=spiff.LabelToggleButton.newCheckbox(E,false);G.get_labelElement().addClass(F);G.tabIndex(0);G.add_propertyChanged(D);this.disposables.add$1(new tab.CallOnDispose(function(){G.remove_propertyChanged(D);}));return G;},$d:function(D){switch(D.which){case 13:{spiff.EventUtil.stopEvent$2(D);this.$o();break;}}},$7:function(){this.$t.analyzeWorkbook();this.$t.hide();},$o:function(){this.$t.save();},$8:function(){this.$t.cancelled();this.$t.hide();},$e:function(){if(ss.isValue(this.$w)){this.$w.remove_closed(ss.mkdel(this,this.$c));this.$w.close(null);this.$x.off('input');this.element.detach();this.$w.dispose();}this.$w=null;},$s:function(){this.$x.on('input',ss.mkdel(this,this.$l));this.$w=new spiff.ModalDialog.$ctor1(this.$t.get_dialogTitle(),this.element);this.$w.get_dialogElement().css('max-width','490px');this.$w.enableTextSelection();this.$w.element.keydown(ss.mkdel(this,this.$d));this.$w.add_closed(ss.mkdel(this,this.$c));this.$w.show();},$c:function(D,E){this.$t.cancelled();this.$t.hide();},$a:function(D,E){this.$t.set_embedCredentials(D);},$b:function(D,E){if(E.get_propertyName()==='selected'){this.$t.set_embedCredentials(D.get_selected());}},$r:function(D,E){if(E.get_propertyName()==='selected'){this.$t.set_showTabs(D.get_selected());}},$l:function(D){this.$t.set_workbookName(this.$x.val());},$m:function(){var D=[];if(this.$t.get_supportsEmbeddedCredentials()&&tabBootstrap.Affordances.isOn('authoring_SaveDialog_ShowOptions')){this.$n(D);if(this.$t.get_isSaveExistingWorkbook()){D.push(w.createSaveDialogEmbedWarning());}}if(this.$t.get_showUserSpecificExtractWarning()){D.push(w.createSaveDialogUserSpecificExtractWarning());}D.push(w.createSaveDialogButtonGroup(ss.mkdel(this,this.$o),this.$t.get_saveEnabled(),ss.mkdel(this,this.$8),ss.mkdel(this,this.$7)));ReactDOM.render(React.createElement('div',{children:Array.prototype.slice.call(D)}),this.$u.get(0));},$n:function(D){if(false){var E=(this.$t.get_embedCredentials()?0:1);D.push(w.createSaveDialogAccessHeader());D.push(w.createEmbedCredsRadioButtons(ss.mkdel(this,this.$a),E));}else{if(ss.isNullOrUndefined(this.$v)){this.$v=this.$9(ss.mkdel(this,this.$b),tab.Strings.AuthSaveLabelEmbedPassword,'tabAuthSaveEmbedCredsCheck');this.element.find('.tabAuthSaveLayoutTable').append($('<tr></tr>').append($('<td></td>').append($('<div></div>').addClass('tabAuthSaveOption').append(this.$v.element))));}if(ss.isValue(this.$v)){this.$v.set_selected(this.$t.get_embedCredentials());}}},$f:function(D){if(!this.$t.get_showProjects()){return D.css({display:'none'});}else{return D;}},$g:function(D){var E=new b();E.container.addClass(D);return E;},$h:function(){var D=new e();D.label.text(tab.Strings.AuthSaveLabelName);return D;},$i:function(){var D=new i();D.label.text(tab.Strings.AuthSaveLabelLocation);D.tableData.addClass('tabAuthSaveProject');return D;},$k:function(){var D=new A();D.saveOption.append(this.$A.element);return D;},$j:function(){var D=new v();D.warningText.text(this.$t.get_saveWarning());return D;}});var u=global.tab.SaveViewModel=ss.mkType(a,'tab.SaveViewModel',function(D){u.$ctor1.call(this,D,new B());},{get_isSaveExistingWorkbook:function(){return this.$2$1;},set_isSaveExistingWorkbook:function(D){this.$2$1=D;},add_shown:function(D){this.$2$2=ss.delegateCombine(this.$2$2,D);},remove_shown:function(D){this.$2$2=ss.delegateRemove(this.$2$2,D);},add_hidden:function(D){this.$2$3=ss.delegateCombine(this.$2$3,D);},remove_hidden:function(D){this.$2$3=ss.delegateRemove(this.$2$3,D);},add_saveSucceeded:function(D){this.$2$4=ss.delegateCombine(this.$2$4,D);},remove_saveSucceeded:function(D){this.$2$4=ss.delegateRemove(this.$2$4,D);},add_saveCancelled:function(D){this.$2$5=ss.delegateCombine(this.$2$5,D);},remove_saveCancelled:function(D){this.$2$5=ss.delegateRemove(this.$2$5,D);},get_projectPickerViewModel:function(){return this.$2$6;},set_projectPickerViewModel:function(D){this.$2$6=D;},get_personalSpaceViewModel:function(){return this.$2$7;},set_personalSpaceViewModel:function(D){this.$2$7=D;},get_currentLocation:function(){return this.$4;},set_currentLocation:function(D){if(ss.referenceEquals(this.$4,D)){return;}this.$4=D;this.notifyPropertyChanged('CurrentLocation');},get_workbookName:function(){return this.$8;},set_workbookName:function(D){if(ss.referenceEquals(this.$8,D)){return;}this.$8=D;this.notifyPropertyChanged('WorkbookName');},get_supportsTabs:function(){return this.saveStrategy.get_supportsTabs();},get_showTabs:function(){return this.$6;},set_showTabs:function(D){this.$6=D;this.notifyPropertyChanged('ShowTabs');},get_supportsEmbeddedCredentials:function(){return this.saveStrategy.get_supportsEmbeddedCredentials();},get_embedCredentials:function(){return this.$5;},set_embedCredentials:function(D){this.$5=D;this.notifyPropertyChanged('EmbedCredentials');},get_showProjects:function(){return !tsConfig.isPublic;},get_saveEnabled:function(){if(tabBootstrap.Affordances.isOff('authoring_SaveDialog_ShowOptions')){return this.$1();}return this.$1()&&ss.isValue(this.$4);},get_saveWarning:function(){return (tab.ApplicationModel.get_instance().get_workbook().get_isWorkbookIncomplete()?tab.Strings.SaveIncompleteWorkbookWarning:null);},get_showUserSpecificExtractWarning:function(){return this.saveStrategy.get_hasUserSpecificExtract();},get_dialogTitle:function(){return this.saveStrategy.get_dialogTitle();},dispose:function(){if(tsConfig.allow_personal_space_only){this.get_personalSpaceViewModel().dispose();}else{this.get_projectPickerViewModel().dispose();}spiff.BaseViewModel.prototype.dispose.call(this);},showSave:function(){if(ss.isValue(this.$2$2)){this.$2$2();}},cancelled:function(){this.raiseActionEvent(this.$2$5);},hide:function(){this.raiseActionEvent(this.$2$3);this.dispose();},analyzeWorkbook:function(){tab.WorkbookAnalyzerCommands.launchWorkbookAnalyzer();},save:function(){if(!this.get_saveEnabled()){return;}this.$3(true);},saveWithoutConfirmingOverwrite:function(){if(!this.get_saveEnabled()){return;}this.$3(false);},$1:function(){return ss.isValue(this.$8)&&this.$8.trim().length>0;},$2:function(){this.raiseActionEvent(this.$2$3);},$3:function(D){var E=this.$7;var F=new C();F.confirmOverwrite=D;F.workbookName=this.get_workbookName();F.currentLocation=this.get_currentLocation();F.showTabs=this.get_showTabs();F.embedCredentials=this.get_embedCredentials();F.backToPreviousDialogCallback=ss.mkdel(this,this.showSave);F.successfulSaveCallback=ss.mkdel(this,function(G){this.$0();this.callSaveSucceeded(G);this.dispose();});F.cancelSaveCallback=ss.mkdel(this,function(){this.cancelled();this.dispose();});E.execute(F);this.$2();},selectedLocationChanged:function(D){this.set_currentLocation(D);},callSaveSucceeded:function(D){this.raiseActionEvent$1(Object).call(this,this.$2$4,D);},handlePersonalSpaceOnly:function(D){if(ss.isNullOrUndefined(D)){return;}var E=new Object();E.id=D.luid;E.name='Personal Space';E.locationType='PERSONAL_SPACE';var F=E;this.selectedLocationChanged(F);},$0:function(){if(ss.referenceEquals(ss.getInstanceType(this.saveStrategy),l)||tsConfig.embeddingV3){return;}this.saveStrategy.get_sessionInfoPresModel().done(ss.mkdel(this,function(D){if(D.site.personalSpaceOnSiteEnabled){var E=this.get_currentLocation().locationType==='PERSONAL_SPACE'||this.get_currentLocation().locationType==='personal_space';var F=(E?tab.Strings.AuthSavePersonalSpaceTitle:ss.formatString('"{0}"',this.get_currentLocation().name));window.sessionStorage.setItem(tab.PublishToastAfterPublishAs.publishToastLocation,F);}if(tsConfig.isPublic){window.sessionStorage.setItem(tab.PublishToastAfterPublishAs.publishToastLocation,'public');}}));}},{$ctor2:function(D,E,F){u.call(this,D);if(!ss.staticEquals(E,null)){this.add_saveSucceeded(E);}if(!ss.staticEquals(F,null)){this.add_saveCancelled(F);}},$ctor1:function(D,E){this.$4=null;this.$8=null;this.$6=false;this.$5=false;this.saveStrategy=null;this.$7=null;this.$2$1=false;this.$2$2=null;this.$2$3=null;this.$2$4=null;this.$2$5=null;this.$2$6=null;this.$2$7=null;spiff.BaseViewModel.call(this);this.$8=D.get_initialName();this.saveStrategy=D;this.$7=E;if(tsConfig.allow_personal_space_only){this.set_personalSpaceViewModel(new h());this.saveStrategy.get_personalSpacePresModel().done(ss.mkdel(this,this.handlePersonalSpaceOnly));}else{this.set_projectPickerViewModel(new k(ss.mkdel(this,this.selectedLocationChanged),this.saveStrategy.get_personalSpacePresModel()));}this.set_showTabs(tsConfig.showTabsWorkbook);this.$5=false;var F=ss.mkdel(this,function(){this.notifyPropertyChanged('SupportsEmbeddedCredentials');});this.saveStrategy.add_embeddedCredentialsSupportChanged(F);this.disposables.add(ss.mkdel(this,function(){this.saveStrategy.remove_embeddedCredentialsSupportChanged(F);}));this.set_isSaveExistingWorkbook(D.get_isSaveExistingWorkbook());}});var v=global.tab.SaveWarningTemplate=ss.mkType(a,'tab.SaveWarningTemplate',function(){this.warningText=null;spiff.Template.call(this,$("\n<div class='tabAuthSaveWarning'>\n  <div class='tabAuthSaveWarningIcon'>\n    <div class='tabAuthSaveWarningText'></div>\n  </div>\n</div>"));this.warningText=this.getElementBySelector('.tabAuthSaveWarningText');});var w=global.tab.SaveWorkbookComponents=ss.mkType(a,'tab.SaveWorkbookComponents',null,null,{createAnalyzeWorkbookButton:function(D){if(tab.NaturalLanguageUtil.isNlpView()){return null;}var E=[spiff.DOMElements.svg({className:w.$4},''),w.createDivWithKey(w.$5,[tab.Strings.WorkbookOptimizer])];return React.createElement(SharedWidgets.ButtonWidget,{handleClick:function(F){D();},buttonType:9,testId:w.$6,children:E,disabled:false,style:{display:'flex',alignItems:'center',padding:'0px'}});},createCancelButton:function(D){return React.createElement(SharedWidgets.ButtonWidget,{handleClick:function(E){D();},buttonType:3,testId:'save-dialog-cancel',children:tab.Strings.AuthSaveButtonCancel,className:'tabAuthSaveCancelButton'});},createSaveButton:function(D,E){return React.createElement(SharedWidgets.ButtonWidget,{handleClick:function(F){D();},buttonType:2,testId:'save-dialog-save',children:tab.Strings.AuthPublishButtonPublish,disabled:!E,className:'tabAuthSaveSaveButton'});},createEmbedCredsRadioButtons:function(D,E){var F=[];F.push({disabled:false,label:tab.Strings.AuthSaveWorkbookAccessEmbed,testId:'SaveWorkbookEmbedCreds',value:true});F.push({disabled:false,label:tab.Strings.AuthSaveWorkbookAccessRequireCreds,testId:'SaveWorkbookRequireCreds',value:false});var G=F;return React.createElement(SharedWidgets.RadioButtonWithLabelGroupWidget,{buttonList:G,checkedIndex:E,layout:0,handleChange:D});},createSaveDialogEmbedWarning:function(){return React.createElement(q,null);},createSaveDialogUserSpecificExtractWarning:function(){return React.createElement(r,null);},createSaveDialogAccessHeader:function(){return React.createElement(n,null);},createSaveDialogButtonGroup:function(D,E,F,G){return React.createElement(o,new p(D,E,F,G));},createDivWithKey:function(D,E){return spiff.DOMElements.div({className:D,key:D},E);}});var x=global.tab.SaveWorkbookStrategy=ss.mkType(a,'tab.SaveWorkbookStrategy',function(D,E,F){this.$1$1=null;this.$1$2=null;this.$1$3=null;this.$1$4=null;this.$1$5=false;this.$1$6=false;this.$1$7=false;this.$1$8=null;this.set_InitialName(((D==='save')?tsConfig.workbookName:''));this.$2(this.constructSuccessHandler(E));this.$1(F);this.$0(false);this.set_isSaveExistingWorkbook(false);this.$3(tab.WorkgroupServerCommands.get_getSessionInfo().then(ss.mkdel(this,this.$5),null));this.$4(this.get_sessionInfoPresModel().then(ss.mkdel(this,this.getPersonalSpaceData),null));},{add_embeddedCredentialsSupportChanged:function(D){this.$1$1=ss.delegateCombine(this.$1$1,D);},remove_embeddedCredentialsSupportChanged:function(D){this.$1$1=ss.delegateRemove(this.$1$1,D);},get_initialName:function(){return this.$1$2;},set_InitialName:function(D){this.$1$2=D;},get_supportsTabs:function(){return true;},get_sessionInfoPresModel:function(){return this.$1$3;},$3:function(D){this.$1$3=D;},get_personalSpacePresModel:function(){return this.$1$4;},$4:function(D){this.$1$4=D;},get_supportsEmbeddedCredentials:function(){return this.$1$5;},$0:function(D){this.$1$5=D;},get_isSaveExistingWorkbook:function(){return this.$1$6;},set_isSaveExistingWorkbook:function(D){this.$1$6=D;},get_hasUserSpecificExtract:function(){return this.$1$7;},$1:function(D){this.$1$7=D;},get_dialogTitle:function(){return tab.Strings.AuthPublishTitle;},get_successHandler:function(){return this.$1$8;},$2:function(D){this.$1$8=D;},initiateSave:function(D){tab.ObjectRegistry.newView(t).call(null,[D]);D.showSave();},raiseWorkbookPublishedAsNotificationForEmbedding:function(D){var E=tab.VizUriModel.createForAuthoringPublishedSheetForEmbedding(tsConfig.current_sheet_name,D).get_absoluteUri();var F={workbookPublishedAsUrl:E};tab.ApplicationModel.get_instance().raiseNotification('doc:workbook-published-as-event',F,null);},constructSuccessHandler:function(D){return ss.mkdel(this,function(E){if(!ss.staticEquals(D,null)){D(E);}this.raiseWorkbookPublishedAsNotificationForEmbedding(E);z.createSessionReloadAction()(E);});},$5:function(D){var E=D.server;var F=D.user;this.$0(E.embeddedCredentialsEnabled||F.canEmbedCredentials);if(tsConfig.isPublic){this.$0(tsConfig.features['PublicWebAuthoring_M3']);}else if(this.get_supportsEmbeddedCredentials()){if(!ss.staticEquals(this.$1$1,null)){this.$1$1();}}return D;},getPersonalSpaceData:function(D){if(D.site.personalSpaceOnSiteEnabled){var E=$.Deferred();tab.VizPortalServer.sendRestRequest(tab.RestApiEndpoints.get_personalSpace(),function(F){E.resolve(F);},function(F){E.reject(F);});return E;}return null;}});var y=global.tab.SavingFactory=ss.mkType(a,'tab.SavingFactory',function(){},{getSaveControllerInstance:function(){return m.get_instance();}});var z=global.tab.SessionReloadActionFactory=ss.mkType(a,'tab.SessionReloadActionFactory',null,null,{createSessionReloadAction:function(){return function(D){var E=tab.VizUriModel.createVizUriModelForAuthoringSheetInWorkbook(tsConfig.current_sheet_name,D);E.removeQueryParam(':showSave').removeQueryParam(':showSaveAs');var F=tabBootstrap.Utility.get_locationWindow();if(E.matchesCurrentWindowLocationUri(null)){tab.WindowHelper.reload(F,false);}else{tab.SessionServerCommands.destroySessionAndForward$1(F,E.get_uri());}};}});var A=global.tab.ShowTabsTemplate=ss.mkType(a,'tab.ShowTabsTemplate',function(){this.saveOption=null;spiff.Template.call(this,$("\n<tr>\n  <td class='tabAuthFirstSaveOption'>\n    <div class='tabAuthSaveOption'></div>\n  </td>\n</tr>"));this.saveOption=this.getElementBySelector('.tabAuthSaveOption');});var B=global.tab.WebSaveAsExecutor=ss.mkType(a,'tab.WebSaveAsExecutor',function(){},{execute:function(D){var E=this.$0(D);tab.SaveServerCommands.SaveWorkbookAs(D.workbookName,D.currentLocation,D.showTabs,D.embedCredentials,D.confirmOverwrite,tab.ApplicationModel.get_instance().get_workbook().get_oAuthCredentialIds(),D.successfulSaveCallback,E);},$0:function(D){return ss.mkdel(this,function(E){if(ss.isValue(E)&&E.code===106){var F=ss.htmlEncode((!ss.isNullOrEmptyString(E.details)?E.details:E.message));tab.ConfirmationViewModel.showConfirmation(tab.Strings.AuthSaveConfirmOverwrite(F),this.$1(D));}else if(tab.PublishErrorTypeHandling.errorHandlerExists(E)){tab.PublishErrorTypeHandling.handleError(E);D.cancelSaveCallback();}else{var G=(tsConfig.isPublic?tab.Strings.PublicAuthSaveErrorTitle:tab.Strings.AuthSaveErrorTitle);var H=(!ss.isNullOrEmptyString(E.details)?E.details:E.message);tab.Application.get_commonDialogProvider().ShowErrorDialog(H,G,null);D.cancelSaveCallback();}});},$1:function(D){return ss.mkdel(this,function(E){switch(E){case 'confirm':{D.confirmOverwrite=false;this.execute(D);break;}case 'deny':{D.backToPreviousDialogCallback();break;}case 'cancel':{D.cancelSaveCallback();break;}}});}});var C=global.tab.WebSaveAsExecutor$SaveAsParams=ss.mkType(a,'tab.WebSaveAsExecutor$SaveAsParams',function(){this.confirmOverwrite=false;this.workbookName=null;this.currentLocation=null;this.showTabs=false;this.embedCredentials=false;this.successfulSaveCallback=null;this.cancelSaveCallback=null;this.backToPreviousDialogCallback=null;});ss.initClass(b,spiff.Template,[ss.IDisposable]);ss.initInterface(c,{add_embeddedCredentialsSupportChanged:null,remove_embeddedCredentialsSupportChanged:null,get_initialName:null,get_supportsTabs:null,get_supportsEmbeddedCredentials:null,get_hasUserSpecificExtract:null,get_successHandler:null,get_sessionInfoPresModel:null,get_personalSpacePresModel:null,get_dialogTitle:null,initiateSave:null});ss.initClass(d,spiff.Template,[ss.IDisposable]);ss.initClass(e,spiff.Template,[ss.IDisposable]);ss.initClass(f);ss.initClass(g,React.PureComponent);ss.initClass(h,ss.makeGenericType(spiff.BaseReactViewModel$1,[Object]),[tab.IViewModel,ss.IDisposable,ss.makeGenericType(spiff.IPropsProvider$1,[Object])]);ss.initClass(i,spiff.Template,[ss.IDisposable]);ss.initClass(j,ss.makeGenericType(tab.PureComponentWithAsyncDependencies$3,[Object,Object,Object]));ss.initClass(k,ss.makeGenericType(spiff.BaseReactViewModel$1,[Object]),[tab.IViewModel,ss.IDisposable,ss.makeGenericType(spiff.IPropsProvider$1,[Object])]);ss.initClass(x,null,[c]);ss.initClass(l,x,[c]);ss.initClass(m,null,[tab.ISaveController]);ss.initClass(n,React.Component);ss.initClass(o,React.Component);ss.initClass(p);ss.initClass(q,React.Component);ss.initClass(r,React.Component);ss.initClass(s);ss.initClass(t,ss.makeGenericType(spiff.BaseView$1,[u]),[tab.IWidget,ss.makeGenericType(tab.IView$1,[u]),ss.IDisposable,tab.IAppendableView]);ss.initClass(u,spiff.BaseViewModel,[tab.IViewModel,ss.IDisposable]);u.$ctor2.prototype=u.$ctor1.prototype=u.prototype;ss.initClass(v,spiff.Template,[ss.IDisposable]);ss.initClass(w);ss.initClass(y,null,[tab.ISavingModule]);ss.initClass(z);ss.initClass(A,spiff.Template,[ss.IDisposable]);ss.initClass(B);ss.initClass(C);(function(){b.$0="\n<tr>\n  <td>\n    <div class='tabAuthSaveContainer'></div>\n  </td>\n</tr>";})();(function(){d.$0="\n<tr>\n  <td>\n    <div class='tabAuthSaveNameRowValue'>\n      <input class='tabAuthSaveTextInput' type='text' tabindex='0'/>\n    </div>\n  </td>\n</tr>";})();(function(){e.$0="\n<tr>\n  <td>\n    <div class='tabAuthSaveLabel tabAuthSaveLabelName'></div>\n  </td>\n</tr>";})();(function(){g.urlTestId='PersonalSpaceUrl';g.$3={position:'relative',width:'100%',marginTop:16,marginBottom:30};g.$4={marginRight:3};})();(function(){i.$0="\n<tr>\n  <td class='tabAuthSaveTableData'>\n    <div class='tabAuthSaveLabel tabAuthSaveLabelDestination'></div>\n  </td>\n</tr>";})();(function(){j.projectPickerContainer='projectPickerContainer';j.$3={position:'relative',height:250,width:'100%'};j.$4={position:'relative',height:'100%',padding:1,borderWidth:1,borderStyle:'solid',borderColor:SharedWidgets.TabStyles.Colors.L4};})();(function(){r.$1='workbook-user-specific-extract-warning';})();(function(){w.$6='save-dialog-analyze-workbook';w.$4='tabAuthAnalyzeWorkbookButtonIcon';w.$5='tabAuthSaveAnalyzeWorkbookButtonLabel';w.$0=spiff.DOMElements.div;w.$2=spiff.DOMElements.span;w.$1=spiff.DOMElements.p;})();(function(){A.$0="\n<tr>\n  <td class='tabAuthFirstSaveOption'>\n    <div class='tabAuthSaveOption'></div>\n  </td>\n</tr>";})();(function(){v.$0="\n<div class='tabAuthSaveWarning'>\n  <div class='tabAuthSaveWarningIcon'>\n    <div class='tabAuthSaveWarningText'></div>\n  </div>\n</div>";})();(function(){t.$1='490px';t.authSaveEmbedCredsCheckClassName='tabAuthSaveEmbedCredsCheck';t.authSaveShowTabsCheckClassName='tabAuthSaveShowTabsCheck';t.authSaveProjectPickerClassName='tabAuthSaveProjectPicker';t.authSavePersonalSpaceClassName='tabAuthSavePersonalSpace';t.authSaveProjectLabelCellClassName='tabAuthSaveProject';t.showAsRadioButtons=false;tab.ObjectRegistry.registerType(t,t).call(null);})();(function(){l.$2=null;l.$3='';})();(function(){m.$1=null;})();})();// END Saving
