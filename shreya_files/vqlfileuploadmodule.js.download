/*! BEGIN FileUploadModule */

(function(){'dont use strict';var a={};global.tab=global.tab||{};ss.initAssembly(a,'vqlfileuploadmodule');var b=global.tab.ByteUtils=ss.mkType(a,'tab.ByteUtils',null,null,{determineBestByteType:function(s){if(s<1024){return tab.Strings.UploadBytes;}else if(s<1048576){return tab.Strings.UploadKB;}else if(s<1073741824){return tab.Strings.UploadMB;}else{return tab.Strings.UploadGB;}},getBytesWithMagnitude:function(s,t){if(ss.referenceEquals(t,tab.Strings.UploadBytes)){return s;}else if(ss.referenceEquals(t,tab.Strings.UploadKB)){return s/1024;}else if(ss.referenceEquals(t,tab.Strings.UploadMB)){return s/1048576;}else{return s/1073741824;}}});var c=global.tab.DataFileUploader=ss.mkType(a,'tab.DataFileUploader',function(s){this.$2=null;this.$6=0;this.$4=null;this.$7=0;this.$5=0;this.$3=null;this.$8='';this.$1$1=null;this.$1$2=null;this.$1$3=null;this.$1$4=false;this.$1$5=0;this.$1$6=0;this.$2=s;this.$6=s.size;this.$4=s.name;this.set_uploadedSize(0);this.add_progressChanged(ss.mkdel(this,function(t){}));},{add_progressChanged:function(s){this.$1$1=ss.delegateCombine(this.$1$1,s);},remove_progressChanged:function(s){this.$1$1=ss.delegateRemove(this.$1$1,s);},add_uploadFinished:function(s){this.$1$2=ss.delegateCombine(this.$1$2,s);},remove_uploadFinished:function(s){this.$1$2=ss.delegateRemove(this.$1$2,s);},add_errorDetected:function(s){this.$1$3=ss.delegateCombine(this.$1$3,s);},remove_errorDetected:function(s){this.$1$3=ss.delegateRemove(this.$1$3,s);},get_canceled:function(){return this.$1$4;},set_canceled:function(s){this.$1$4=s;},get_file:function(){return this.$2;},get_size:function(){return this.$6;},get_name:function(){return this.$4;},get_uploadedSize:function(){return this.$1$5;},set_uploadedSize:function(s){this.$1$5=s;},get_elapsedTime:function(){return this.$1$6;},set_elapsedTime:function(s){this.$1$6=s;},get_progress:function(){return this.$5;},set_progress:function(s){if(this.$5!==s){this.$5=s;if(!ss.staticEquals(this.$1$1,null)){this.$1$1(this.$5);}}},get_isComplete:function(){return this.get_progress()===100;},cancelUpload:function(){this.set_canceled(true);if(this.get_isComplete()){h.cancelFileUpload(this.$8);}},createUpload:function(){var s=h.createFileUpload(this.$6);s.then(ss.mkdel(this,function(t){this.upload(t);}),ss.mkdel(this,function(t){this.$0(t);}));},upload:function(s){this.$3=new FileReader();this.$8=s;var t=tab.DateUtil.get_nowAsTime();this.$3.onloadend=ss.mkdel(this,function(u){var v=h.appendToFile(s,new Uint8Array(this.$3.result));v.then(ss.mkdel(this,function(w){if(this.get_canceled()){h.cancelFileUpload(s);return;}this.set_uploadedSize(this.$7);if(this.$7<this.$6){this.set_progress(Math.floor(this.$7/this.$6*100));this.$1();}else{this.set_progress(100);if(!ss.staticEquals(this.$1$2,null)){this.set_elapsedTime(tab.DateUtil.get_nowAsTime()-t);this.$1$2(s);}}}),ss.mkdel(this,function(w){this.$0(w);}));});this.$1();},$1:function(){this.$7=Math.min(this.get_uploadedSize()+2097152,this.$6);var s=this.get_file().slice(this.get_uploadedSize(),this.$7);this.$3.readAsArrayBuffer(s);},$0:function(s){this.cancelUpload();this.$1$3(s);}},{new$1:function(s){return new c(s);}});var d=global.tab.FatalErrorComponent=ss.mkType(a,'tab.FatalErrorComponent',function(s){spiff.PureRenderComponent.call(this,s);},{get_getTitle:function(){return tab.Strings.FileUploadFatalErrorTitle;},render:function(){return spiff.DOMElements.div({className:'tab-uploadDialog-fatalError'},spiff.DOMElements.div({className:'tab-uploadDialog-fatalError-title'},this.get_getTitle()),spiff.DOMElements.div({className:'tab-uploadDialog-fatalError-subtitle'},this.$0()),this.$1(),spiff.DOMElements.div({className:'tab-uploadDialog-fatalError-buttonContainer'},this.createCancelButton(),this.createAddButton(),this.createSkipButton()));},$0:function(){switch(this.props.fatalErrorType){case 0:{break;}case 1:{return tab.Strings.FileUploadFatalErrorUnsupportedFileTypeSubtitle;}case 2:{var s=_.find(this.props.recentlyIgnoredFiles,function(z){return g.isFileTypeSupported(z,'');});var t=g.getFileTypeFromExtension(g.getFileExtension(s));if(ss.referenceEquals(t,tab.Strings.FileUploadFileTypeExcel)){t=tab.Strings.FileUploadFileTypeExcelFile;}var u=g.getConnectionClassToFileTypeName(this.props.connectionClass);var v=(this.$2(u)?2:0);v+=(this.$2(t)?1:0);switch(v){case 0:{return tab.Strings.FileUploadFatalErrorUnsupportedFileTypeByConnectionSubtitle_a_a(u,t);}case 1:{return tab.Strings.FileUploadFatalErrorUnsupportedFileTypeByConnectionSubtitle_a_an(u,t);}case 2:{return tab.Strings.FileUploadFatalErrorUnsupportedFileTypeByConnectionSubtitle_an_a(u,t);}default:{return tab.Strings.FileUploadFatalErrorUnsupportedFileTypeByConnectionSubtitle_an_an(u,t);}}}case 3:{var w=b.determineBestByteType(this.props.maxFileSize);var x=b.getBytesWithMagnitude(this.props.maxFileSize,w);var y=ss.formatString('{0:N1} {1}',x,w);return tab.Strings.FileUploadFatalErrorFileIsTooBigSubtitle(y);}case 4:{return tab.Strings.FileUploadFatalErrorFileIsEmptySubtitle;}case 5:{return tab.Strings.FileUploadFatalErrorFileExists;}case 6:{return tab.Strings.DragAndDropError_Multi;}case 7:{return tab.Strings.FileUploadAccessError;}default:{break;}}return null;},$1:function(){if(this.props.fatalErrorType===2||this.props.fatalErrorType===6||this.props.fatalErrorType===7){return null;}var s=spiff.DOMElements.div({},_.map(this.props.recentlyIgnoredFiles,ss.mkdel(this,function(t,u){return spiff.DOMElements.div({key:u},t);})));return spiff.DOMElements.div({className:'tab-uploadDialog-fatalError-recentlyIgnoredContainer'},s);},createCancelButtonProps:function(){return {handleClick:ss.mkdel(this,function(s){this.props.dismiss();}),buttonType:3,testId:'FatalErrorCancelButton',children:tab.Strings.FileUploadButtonCancel};},createSkipButtonProps:function(){return {handleClick:ss.mkdel(this,function(s){this.props.skip();}),buttonType:2,testId:'FatalErrorSkipButton',style:{left:'12px'},children:((this.props.recentlyIgnoredFiles.length===1)?tab.Strings.FileUploadButtonSkipSingular:tab.Strings.FileUploadButtonSkipPlural)};},$2:function(s){return s.length>0&&'aeiouAEIOU'.indexOf(String.fromCharCode(s.charCodeAt(0)))!==-1;},createCancelButton:function(){return React.createElement(SharedWidgets.ButtonWidget,this.createCancelButtonProps());},createAddButton:function(){return null;},createSkipButton:function(){return ((this.props.eligibleFileCount>0)?ss.mkdel(this,function(){return React.createElement(SharedWidgets.ButtonWidget,this.createSkipButtonProps());})():null);}});var e=global.tab.FatalErrorFileExistsComponent=ss.mkType(a,'tab.FatalErrorFileExistsComponent',function(s){d.call(this,s);},{get_getTitle:function(){return tab.Strings.FileUploadFatalErrorSameFileTitle;},createAddButtonProps:function(){return {handleClick:ss.mkdel(this,function(s){this.props.add();}),buttonType:2,testId:'FatalErrorAddButton',children:tab.Strings.FileUploadButtonAdd};},createCancelButtonProps$1:function(){return {handleClick:ss.mkdel(this,function(s){this.props.dismiss();}),buttonType:3,testId:'FatalErrorCancelButton',style:{right:'12px'},children:tab.Strings.FileUploadButtonCancel};},createCancelButton:function(){return React.createElement(SharedWidgets.ButtonWidget,this.createCancelButtonProps$1());},createAddButton:function(){return React.createElement(SharedWidgets.ButtonWidget,this.createAddButtonProps());},createSkipButton:function(){var s=this.createSkipButtonProps();s.children=tab.Strings.FileUploadButtonReplaceUpdate;return React.createElement(SharedWidgets.ButtonWidget,s);}});var f=global.tab.FatalErrorType=ss.mkEnum(a,'tab.FatalErrorType',{none:0,unsupportedType:1,fileTypeMismatch:2,fileTooBig:3,fileIsEmpty:4,fileAlreadyExists:5,multiFileNotExpected:6,fileIsLocked:7});var g=global.tab.FileTypeUtils=ss.mkType(a,'tab.FileTypeUtils',null,null,{getFileExtensionsForConnectionType:function(s){switch(s){case 'excel-direct':{return ['.xls','.xlsx','.xlsm'];}case 'textscan':{return ['.txt','.csv','.tab','.tsv'];}case 'ogrdirect':{return ['.geojson','.kml','.kmz','.topojson','.zip'];}default:{return [];}}},getFileTypeFromExtension:function(s){switch(s){case '.xls':case '.xlsm':case '.xlsx':{return tab.Strings.FileUploadFileTypeExcel;}case '.csv':case '.tab':case '.tsv':case '.txt':{return tab.Strings.FileUploadFileTypeText;}case '.accdb':case '.mdb':{return tab.Strings.FileUploadFileTypeAccess;}case '.json':{return tab.Strings.FileUploadFileTypeJson;}case '.geojson':case '.kml':case '.kmz':case '.mif':case '.shp':case '.topojson':case '.zip':{return tab.Strings.FileUploadFileTypeSpatial;}case '.rda':case '.rdata':case '.sas7bdat':case '.sav':{return tab.Strings.FileUploadFileTypeStatistical;}default:{return tab.Strings.FileUploadFileTypeOther;}}},getFileExtension:function(s){var t=s.lastIndexOf(String.fromCharCode(46));return s.substr(t,s.length-t).toLowerCase();},getAllFileTypes:function(s){var t='';var u=', ';s.forEach(function(v){t+=v+u;});return ss.removeString(t,t.length-u.length);},isFileTypeSupported:function(s,t){var u=g.getFileExtension(s);if(ss.isNullOrEmptyString(t)){return _.contains(g.allSupportedFileExtensions,u);}else{return _.contains(g.getFileExtensionsForConnectionType(t),u);}},getConnectionClassToFileTypeName:function(s){switch(s){case 'excel':case 'excel-direct':{return tab.Strings.FileUploadFileTypeExcelFile;}case 'csv':case 'textscan':{return tab.Strings.FileUploadFileTypeText.toLowerCase();}case 'ogrdirect':{return tab.Strings.FileUploadFileTypeSpatial;}default:{return '';}}}});var h=global.tab.FileUploadCommands=ss.mkType(a,'tab.FileUploadCommands',null,null,{appendToFile:function(s,t){var u=$.Deferred();var v={type:'POST',url:tabBootstrap.BaseUrlFormatter.formatSessionMethod('fileUploadAppend',tsConfig.sessionid,tsConfig.vizql_root)+'/'+s,headers:ss.mkdict(['Accept','text/javascript']),dataType:'json',contentType:'application/octet-stream',processData:false,data:t,success:function(w,x,y){u.resolve();},error:function(w,x,y){var z=h.$0(w);u.reject(z);}};tab.SessionHeartbeat.onVizportalPinged();tab.VizQLServer.sendAjaxRequest(v,null);return u.promise();},getMaxFileUploadSize:function(){var s=$.Deferred();var t={type:'GET',url:tabBootstrap.BaseUrlFormatter.formatSessionMethod('getMaxFileUploadSize',tsConfig.sessionid,tsConfig.vizql_root),headers:ss.mkdict(['Accept','text/javascript']),dataType:'json',data:{},success:function(u,v,w){var x=u;s.resolve(x.maxsize);},error:function(u,v,w){var x=h.$0(u);s.reject(x);}};tab.SessionHeartbeat.onVizportalPinged();tab.VizQLServer.sendAjaxRequest(t,null);return s.promise();},createFileUpload:function(s){var t=$.Deferred();var u=ss.mkdict(['totalFileSize',s.toString()]);var v={type:'POST',url:tabBootstrap.BaseUrlFormatter.formatSessionMethod('fileUploadCreate',tsConfig.sessionid,tsConfig.vizql_root),headers:ss.mkdict(['Accept','text/javascript']),data:u,dataType:'json',success:function(w,x,y){var z=w;var A=z.file.id;tab.ApplicationModel.get_instance().trackUploadedFile(A,s);t.resolve(A);},error:function(w,x,y){var z=h.$0(w);t.reject(z);}};tab.SessionHeartbeat.onVizportalPinged();tab.VizQLServer.sendAjaxRequest(v,null);return t.promise();},cancelFileUpload:function(s){var t={type:'POST',url:tabBootstrap.BaseUrlFormatter.formatSessionMethod('fileUploadCancel',tsConfig.sessionid,tsConfig.vizql_root)+'/'+s,headers:ss.mkdict(['Accept','text/javascript']),dataType:'json'};tab.SessionHeartbeat.onVizportalPinged();tab.VizQLServer.sendAjaxRequest(t,null);},createDataSourceFromFileUpload:function(s,t,u,v){var w=new tab.CreateDataSourceFromFileUploadCmd();w.set_fileIds(s);w.set_dsClasses(t);w.set_fileNames(u);var x=w;if(!ss.isNullOrEmptyString(v)){x.set_datasourceName(v);}return x.invoke();},replaceFileConnectionFromFileUpload:function(s,t,u,v,w){var x=new tab.ReplaceFileConnectionFromFileUploadCmd();x.set_fileIds(s);x.set_dsClass(t);x.set_fileKeep(!w);x.set_fileNames(u);x.set_connectionName(v);var y=x;return y.invoke();},getFileConnectionFileList:function(s,t){if(ss.isNullOrEmptyString(t)||t!=='textscan'){var u=$.Deferred();var v=(new tab.GetFileConnectionFileListCmd$ResponseBuilder([])).build();u.resolve(v);return u.promise();}var w=new tab.GetFileConnectionFileListCmd();w.set_connectionName(s);var x=w;return x.invoke();},copyTempFileToSessionSpecificStorage:function(s,t){var u=new tab.CopyTempFileToSessionSpecificStorageCmd();u.set_fileId(t);u.set_fileName(s);var v=u;return v.invoke();},$0:function(s){var t=null;var u=s;if(!ss.isNullOrUndefined(u)){var v=u['responseJSON'];if(!ss.isNullOrUndefined(v)){if(ss.keyExists(v,'msg')){t=v['msg'];}else if(ss.keyExists(v,'message')){t=v['message'];}}}if(tab.MiscUtil.isNullOrEmpty$1(t)){t=tab.Strings.FileUploadServerUnresponsive;}return t;}});var i=global.tab.FileUploadInfo=ss.mkType(a,'tab.FileUploadInfo',null,null,{createInstance:function(){return i.$ctor();},$ctor:function(){var s={};s.fileSize=0;s.name=null;s.progress=0;return s;},isInstanceOfType:function(){return true;}});var j=global.tab.FileUploadModuleFactory=ss.mkType(a,'tab.FileUploadModuleFactory',function(){},{uploadFiles:function(s){var t=$.Deferred();var u=document.createElement('div');var v=0;h.getMaxFileUploadSize().done(function(w){v=w;}).always(ss.mkdel(this,function(){var w={dismiss:ss.mkdel(this,function(){this.$0(u);}),files:s,maxFileSize:v,onFileUploadFinished:ss.mkdel(this,function(x,y,z){this.$0(u);t.resolve(x);}),onAllFileUploadsFinished:function(x){}};ReactDOM.render(React.createElement(r,w),u);}));return t.promise();},copyTempFileToSessionStorage:function(s,t){var u=$.Deferred();h.copyTempFileToSessionSpecificStorage(s.name,t).done(function(v){u.resolve(v.sessionStorageId);});return u.promise();},$0:function(s){var t=s;s=null;if(!ss.isNullOrUndefined(t)){_.defer(function(){ReactDOM.unmountComponentAtNode(t);});}}});var k=global.tab.ProgressBarComponent=ss.mkType(a,'tab.ProgressBarComponent',function(s){spiff.PureRenderComponent.call(this,s);},{render:function(){var s=(this.props.doneUploadingAllFiles?(' '+'done'):'');s=(this.props.failed?(' '+'error'):s);return spiff.DOMElements.div({},spiff.DOMElements.progress({className:'tab-uploadDialog-progressBar'+s,max:100,value:((this.props.doneUploadingAllFiles||this.props.failed)?'100':this.props.totalProgressPercent.toString())}),spiff.DOMElements.div({className:'tab-uploadDialog-fraction'},ss.formatString(tab.Strings.FileUploadProgressIndicator(this.props.uploadedSoFar,this.props.totalSize,this.props.byteType))));}});var l=global.tab.UploadDataFileErrorInfosComponent=ss.mkType(a,'tab.UploadDataFileErrorInfosComponent',function(s){spiff.PureRenderComponent.call(this,s);},{render:function(){return spiff.DOMElements.div({className:'tab-uploadDialog-errorInfosArea'},((ss.isValue(this.props.filesThatSucceeded)&&this.props.filesThatSucceeded.length>0)?ss.mkdel(this,function(){return spiff.DOMElements.div({className:'tab-uploadDialog-errorInfosCompletedSection'},spiff.DOMElements.div({className:'tab-uploadDialog-errorInfosCompletedHeader'},tab.Strings.FileUploadErrorInfosCompletedHeader),spiff.DOMElements.div({className:'tab-uploadDialog-errorInfosCompletedContent'},_.map(this.props.filesThatSucceeded,ss.mkdel(this,function(s,t){return spiff.DOMElements.div({key:t},s);}))));})():null),spiff.DOMElements.div({className:'tab-uploadDialog-errorInfosFailedSection'},spiff.DOMElements.div({className:'tab-uploadDialog-errorInfosFailedHeader'},tab.Strings.FileUploadErrorInfosFailedHeader),spiff.DOMElements.div({className:'tab-uploadDialog-errorInfosFailedContent'},_.map(this.props.filesThatFailed,ss.mkdel(this,function(s,t){return spiff.DOMElements.div({key:t,title:(ss.isValue(this.props.reasons)?this.props.reasons[t]:s)},s);})))));}});var m=global.tab.UploadDataFileProgressComponent$1=ss.mkType(a,'tab.UploadDataFileProgressComponent$1',function(s){var t=ss.registerGenericClassInstance(m,[s],function(u){spiff.PureRenderComponent.call(this,u);},{render:function(){if(this.props.done&&!this.props.hasProcessingError){window.setTimeout(ss.mkdel(this,this.$0),1000);}return spiff.DOMElements.div({className:'tab-uploadDialog-fileUploadUI',key:this.props.key},spiff.DOMElements.div({className:'tab-uploadDialog-progressContainer'},this.renderTitle(),this.renderCurrentFile(),this.renderFileDescription(),this.renderProgressBar(),this.renderSpinner(),spiff.DOMElements.div({className:'tab-uploadDialog-expandosArea'},this.renderMoreButton()),(this.props.hasProcessingError?React.createElement(SharedWidgets.ButtonWidget,this.createCloseButtonProps()):this.renderMoreArea())),spiff.DOMElements.div({className:'tab-uploadDialog-fatalError-buttonContainer'},this.renderIgnoreAndContinue(),(this.props.hasProcessingError?this.renderMoreArea():React.createElement(SharedWidgets.ButtonWidget,this.createCloseButtonProps())),this.renderRetry()));},renderTitle:function(){return spiff.DOMElements.div({className:'tab-uploadDialog-title'},this.$1());},renderMoreButton:function(){return null;},renderRetry:function(){return null;},renderMoreArea:function(){return null;},renderIgnoreAndContinue:function(){return null;},renderProgressBar:function(){return (!this.$2()?ss.mkdel(this,function(){return React.createElement(k,this.createProgressBarProps());})():null);},renderFileDescription:function(){return ((!this.$2()&&ss.isValue(this.props.fileTypeSet))?ss.mkdel(this,function(){return spiff.DOMElements.div({className:'tab-uploadDialog-fileDescription'},g.getAllFileTypes(this.props.fileTypeSet));})():null);},renderCurrentFile:function(){return ((this.props.numberOfFiles===1)?ss.mkdel(this,function(){return spiff.DOMElements.div({className:'tab-uploadDialog-currentFileName'},this.props.fileName);})():null);},createProgressBarProps:function(){return {failed:false,byteType:this.props.byteType,totalProgressPercent:this.props.totalProgressPercent,totalSize:this.props.totalSize,uploadedSoFar:this.props.uploadedSoFar,doneUploadingAllFiles:this.props.done};},createCloseButtonProps:function(){var u=this.props.done;var v=this.$2();var w=(this.props.done?2:(v?1:3));var x=ss.mkdel(this,function(y){this.$0();});return {handleClick:x,buttonType:w,testId:'FileUploadExitButton',children:(u?tab.Strings.FileUploadButtonClose:tab.Strings.FileUploadButtonCancel),disabled:this.props.isProcessing,style:{visibility:((u&&!this.props.hasProcessingError)?'hidden':'visible')}};},renderSpinner:function(){return (this.$2()?ss.mkdel(this,function(){return spiff.DOMElements.div({style:{marginTop:'18px'}},React.createElement(SharedWidgets.ActivitySpinnerWidget,{testId:'fileupload-spinner'}));})():null);},$1:function(){if(ss.isValue(this.props.title)){return this.props.title;}else if(this.props.numberOfFiles<1){return tab.Strings.FileUploadPreProcessingTitle;}else if(this.props.numberOfFiles===1){return tab.Strings.FileSingleUploadTitle;}else{return tab.Strings.FileUploadTitle(this.props.numberOfFiles);}},$0:function(){if(!this.props.done){this.props.cancelUpload();}this.props.dismiss();},$2:function(){return this.props.isProcessing||this.props.numberOfFiles===0;}},null,function(){return spiff.PureRenderComponent;});return t;});ss.initGenericClass(m,1);var n=global.tab.UploadDataFileProgressDialogComponent=ss.mkType(a,'tab.UploadDataFileProgressDialogComponent',function(s){React.Component.call(this,s);},{render:function(){return React.createElement(SharedWidgets.DialogWidget,{children:this.props.children,isModal:true,isGlassTransparent:false,onCloseRequest:this.props.dismiss,handleGlassClick:function(){},positioningBehavior:0,shouldAdjustPositionOnWindowResize:true,type:2,title:tab.Strings.FileUploadProgressDialogTitle,testId:'tabUploadProgressDialog',zIndex:1000});}});var o=global.tab.UploadDataFileProgressErrorComponent=ss.mkType(a,'tab.UploadDataFileProgressErrorComponent',function(s){ss.makeGenericType(m,[Object]).call(this,s);},{renderTitle:function(){var s=((this.props.numberOfFiles>1)?ss.mkdel(this,function(){return spiff.DOMElements.div({className:'tab-uploadDialog-errorTitleComplete'},tab.Strings.FileUploadErrorTitleMultiComplete(this.props.successFilesCount));})():null);var t=((this.props.numberOfFiles>1)?ss.mkdel(this,function(){return spiff.DOMElements.div({className:'tab-uploadDialog-errorTitleFailed'},tab.Strings.FileUploadErrorTitleMultiFailed(this.props.failedFilesCount));})():null);return spiff.DOMElements.div({},s,t,((this.props.numberOfFiles===1)?ss.mkdel(this,function(){return spiff.DOMElements.div({className:'tab-uploadDialog-errorTitle'},tab.Strings.FileUploadErrorTitle);})():null));},renderMoreButton:function(){return ((this.props.numberOfFiles>1)?ss.mkdel(this,function(){return React.createElement(SharedWidgets.ExpandoWidget,{isExpanded:this.props.showingMore,onExpand:this.props.toggleShowMore,onCollapse:this.props.toggleShowMore,direction:1,testId:'MoreButtonExpando',label:(this.props.showingMore?tab.Strings.HideDetailsLabel:tab.Strings.ShowDetailsLabel)});})():null);},renderRetry:function(){return React.createElement(SharedWidgets.ButtonWidget,{handleClick:ss.mkdel(this,function(s){this.props.retry();}),buttonType:2,testId:'FileUploadRetryButton',children:tab.Strings.FileUploadButtonRetry,style:{float:'right',marginLeft:'12px'}});},createProgressBarProps:function(){var s=ss.makeGenericType(m,[Object]).prototype.createProgressBarProps.call(this);s.failed=true;return s;},renderIgnoreAndContinue:function(){return ((this.props.successFilesCount>0&&this.props.numberOfFiles!==1)?ss.mkdel(this,function(){return React.createElement(SharedWidgets.ButtonWidget,{handleClick:ss.mkdel(this,function(s){this.props.ignoreAndContinue();}),buttonType:3,testId:'FileUploadIgnoreAndContinueButton',children:tab.Strings.FileUploadFailureIgnoreAndContinueLabel,style:{marginRight:'12px'}});})():null);},renderMoreArea:function(){if(this.props.numberOfFiles===1){return spiff.DOMElements.div({className:'tab-uploadDialog-errorMessage'},this.props.errorMessage);}else{return (this.props.showingMore?ss.mkdel(this,function(){return spiff.DOMElements.div({className:'tab-uploadDialog-errorMoreAreaContainer'},React.createElement(l,this.props.errorInfosProps));})():null);}}});var p=global.tab.UploadDataFileProgressErrorConstants=ss.mkType(a,'tab.UploadDataFileProgressErrorConstants');var q=global.tab.UploadFileComponent=ss.mkType(a,'tab.UploadFileComponent',function(s){React.Component.call(this,s);this.state={fatalErrorType:0,filesToIgnore:[],recentlyIgnoredFiles:[],uploadErrorMsg:{}};},{componentDidMount:function(){window.setTimeout(ss.mkdel(this,function(){this.$9(this.props.files);}),100);},render:function(){if(this.state.fatalErrorType!==0){var s=this.$1();if(this.state.fatalErrorType===5){return React.createElement(e,s);}else{return React.createElement(d,s);}}if(ss.isNullOrUndefined(this.state.fileUploaders)){return React.createElement(ss.makeGenericType(m,[Object]),this.createProgressProps());}var t=this.$7();if(t){var u=this.createErrorProps();if(this.$5()&&!ss.staticEquals(this.props.createCustomProcessingErrorComponent,null)){return this.props.createCustomProcessingErrorComponent(u);}else{return React.createElement(o,u);}}else{return React.createElement(ss.makeGenericType(m,[Object]),this.createProgressProps());}},createProgressProps:function(){var s=_.reduce(this.state.fileUploaders,function(E,F){return E+F.get_size();},0);var t=_.reduce(this.state.fileUploaders,function(E,F){return E+F.get_uploadedSize();},0);var u=t/s*100;var v=b.determineBestByteType(s);var w=(ss.isValue(this.state.fileUploaders)?this.state.fileUploaders.length:0);var x=((w>0)?this.state.fileUploaders[0].get_name():'');var y=b.getBytesWithMagnitude(s,v);var z=ss.formatString('{0:N1}',y);var A=b.getBytesWithMagnitude(t,v);var B=ss.formatString('{0:N1}',A);var C=x;if(!ss.isNullOrEmptyString(C)){C=ss.replaceAllString(C,':','_');}var D=this.$5();return {byteType:v,cancelUpload:ss.mkdel(this,this.$0),dismiss:this.props.dismiss,done:this.props.done,fileName:C,hasProcessingError:D,key:w,numberOfFiles:w,isProcessing:this.props.isProcessing,title:this.props.currentActionMessage,totalProgressPercent:ss.trunc(u),totalSize:z,uploadedSoFar:B};},createErrorProps:function(){var s=[];_.each(this.state.fileUploaders,function(x){s.push(x.get_name());});var t=_.difference(s,this.state.filesToIgnore);var u=this.$5();if(u&&!(typeof(this.props.processingTelemetryType)==='undefined')){t=this.props.uploadOrProcessingFailedFiles;_.each(t,ss.mkdel(this,function(x){tab.FileUploadTelemetry.getInstance().logFileUploadFailureEvent(q.$1[x],this.props.processingTelemetryType);}));}var v=_.map(t,ss.mkdel(this,function(x,y){if(u){if(ss.isValue(this.props.uploadOrProcessingFailureReasons)){return this.props.uploadOrProcessingFailureReasons[y];}return ss.coalesce(this.props.defaultProcessingErrorReason,'');}else{if(ss.keyExists(this.state.uploadErrorMsg,x)){return this.state.uploadErrorMsg[x];}return tab.Strings.FileUploadUploadErrorReason;}}));var w={filesThatFailed:t,filesThatSucceeded:_.difference(s,t),reasons:v};return _.extend({successFilesCount:s.length-t.length,failedFilesCount:t.length,ignoreAndContinue:ss.mkdel(this,function(){var x=((typeof(this.state.overwrite)==='undefined')?true:this.state.overwrite);this.props.onAllFileUploadsFinished(x);this.setState({errorMessage:null,fileUploaders:_.filter(this.state.fileUploaders,function(y){return !ss.contains(t,y.get_name());}),showingMore:false});}),toggleShowMore:ss.mkdel(this,function(){this.setState({showingMore:!this.state.showingMore});}),retry:ss.mkdel(this,function(){tab.FileUploadTelemetry.getInstance().logFileUploadRetryEvent('retry');var x=_.filter(this.props.files,ss.mkdel(this,function(y){return !ss.contains(this.state.filesToIgnore,y.name);}));this.$9(x);this.setState({errorMessage:null,showingMore:false});}),errorMessage:(u?this.props.processingErrorTitle:this.state.errorMessage),errorInfosProps:w,showingMore:this.state.showingMore},this.createProgressProps());},$1:function(){var s=_.filter(this.props.files,ss.mkdel(this,function(t){return !ss.contains(this.state.filesToIgnore,t.name);}));return {dismiss:ss.mkdel(this,function(){var t=this.state.fatalErrorType===5;if(t){tab.FileUploadTelemetry.getInstance().logFileUploadReplaceEvent('cancel');}else{tab.FileUploadTelemetry.getInstance().logFileUploadRetryEvent('cancel');}this.props.dismiss();}),eligibleFileCount:s.length,fatalErrorType:this.state.fatalErrorType,key:this.state.recentlyIgnoredFiles.length,maxFileSize:this.props.maxFileSize,recentlyIgnoredFiles:this.state.recentlyIgnoredFiles,skip:ss.mkdel(this,function(){var t=this.state.fatalErrorType===5;this.setState({fatalErrorType:0,recentlyIgnoredFiles:[],overwrite:(t?true:this.state.overwrite)},ss.mkdel(this,function(){if(t){tab.FileUploadTelemetry.getInstance().logFileUploadReplaceEvent('replace');}else{tab.FileUploadTelemetry.getInstance().logFileUploadRetryEvent('skip');}this.$9(s);return null;}));}),add:ss.mkdel(this,function(){this.setState({fatalErrorType:0,recentlyIgnoredFiles:[],overwrite:false},ss.mkdel(this,function(){tab.FileUploadTelemetry.getInstance().logFileUploadReplaceEvent('add');this.$9(s);return null;}));})};},$4:function(){if(this.state.fatalErrorType===2&&!ss.staticEquals(this.props.getMismatchErrorSubtitle,null)){return this.props.getMismatchErrorSubtitle(this.state.recentlyIgnoredFiles);}return '';},$0:function(){_.each(this.state.fileUploaders,function(s){tab.FileUploadTelemetry.getInstance().logFileUploadFailureEvent(q.$1[s.get_name()],'upload_canceled');s.cancelUpload();});},$a:function(){return _.reduce(this.state.fileUploaders,function(s,t){return s&&t.get_isComplete();},true);},$7:function(){return ss.isValue(this.state.errorMessage)&&_.reduce(this.state.fileUploaders,function(s,t){return s&&(t.get_isComplete()||t.get_canceled());},true)||this.$5();},$9:function(s){if(ss.isNullOrUndefined(s)){return;}if(this.state.filesToIgnore.length===0&&this.state.recentlyIgnoredFiles.length===0&&ss.isNullOrUndefined(this.state.fileUploaders)){ss.clearKeys(q.$1);_.each(s,function(A,B){tab.FileUploadTelemetry.getInstance().logFileUploadStartEvent(B,g.getFileExtension(A.name),A.size);q.$1[A.name]=B;});}var t=_.filter(this.state.fileUploaders,function(A){return !A.get_canceled()&&A.get_isComplete();});var u=this.$3();var v=u.item1;var w=u.item2;if(ss.isNullOrUndefined(w)&&ss.isValue(v)){for(var x=0;x<v.length;x++){var y=v[x];var z={$:c.new$1(y)};z.$.add_uploadFinished(ss.mkdel({uploader1:z,$this:this},function(A){var B=this.uploader1.$.get_name();tab.FileUploadTelemetry.getInstance().logFileUploadSuccessEvent(q.$1[B],this.uploader1.$.get_elapsedTime());var C='textscan';var D=g.getFileTypeFromExtension(g.getFileExtension(B));if(ss.referenceEquals(D,tab.Strings.FileUploadFileTypeExcel)){C='excel-direct';}else if(ss.referenceEquals(D,tab.Strings.FileUploadFileTypeSpatial)){C='ogrdirect';}this.$this.props.onFileUploadFinished(A,C,B);if(this.$this.$a()){var E=((typeof(this.$this.state.overwrite)==='undefined')?true:this.$this.state.overwrite);this.$this.props.onAllFileUploadsFinished(E);}}));t.push(z.$);z.$.add_progressChanged(ss.mkdel({uploader1:z,$this:this},function(){if(this.uploader1.$.get_isComplete()){var A=ss.arrayClone(this.$this.state.filesToIgnore);A.push(this.uploader1.$.get_name());this.$this.setState({filesToIgnore:A});}else{this.$this.forceUpdate();}}));z.$.add_errorDetected(ss.mkdel({uploader1:z,$this:this},function(A){tab.FileUploadTelemetry.getInstance().logFileUploadFailureEvent(q.$1[this.uploader1.$.get_name()],'upload_error');var B=this.$this.state.uploadErrorMsg;B[this.uploader1.$.get_name()]=A;this.$this.setState({errorMessage:A,uploadErrorMsg:B});}));z.$.createUpload();}this.setState({fileUploaders:t,showingMore:false});}},$3:function(){var s=this.$2();this.$8(s.ineligibleFiles,s.fatalErrorType);return {item1:s.filesToUpload,item2:s.ineligibleFiles};},$2:function(){if(this.props.files.length===0){var s={fatalErrorType:7,filesToUpload:null,ineligibleFiles:null};tab.FileUploadTelemetry.getInstance().logFileUploadFailureEvent(0,'locked');return s;}if(this.props.files.length>1&&!this.props.isMultiFileAllowed){var t={fatalErrorType:6,filesToUpload:null,ineligibleFiles:this.props.files};tab.FileUploadTelemetry.getInstance().logFileUploadFailureEvent(0,'multi_file_rejected');return t;}var u=_.filter(this.props.files,ss.mkdel(this,function(C){return !ss.contains(this.state.filesToIgnore,C.name);}));var v=((this.props.maxFileSize===0)?[]:_.filter(u,ss.mkdel(this,function(C){return C.size>this.props.maxFileSize;})));var w=_.filter(u,function(C){return C.size===0;});var x=((typeof(this.state.overwrite)==='undefined'&&!(typeof(this.props.existingFilesToNotOverwrite)==='undefined'))?_.filter(u,ss.mkdel(this,function(C){return _.any(this.props.existingFilesToNotOverwrite,function(D){return ss.compareStrings(D,C.name,true)===0;});})):null);if(ss.isValue(x)&&x.length>0){var y={fatalErrorType:5,filesToUpload:null,ineligibleFiles:x};this.$6(y.ineligibleFiles,'exists');return y;}if(!ss.staticEquals(this.props.customFileFilter,null)){var z=this.props.customFileFilter(u);if(z.fatalErrorType!==0){if(z.fatalErrorType===2){this.$6(z.ineligibleFiles,'type_mismatch');}if(z.fatalErrorType===1){this.$6(z.ineligibleFiles,'unsupported');}return z;}}if(v.length>0){var A={fatalErrorType:3,filesToUpload:_.difference(u,v),ineligibleFiles:v};this.$6(A.ineligibleFiles,'too_big');return A;}if(w.length>0){var B={fatalErrorType:4,filesToUpload:_.difference(u,w),ineligibleFiles:w};this.$6(B.ineligibleFiles,'empty');return B;}return {fatalErrorType:0,filesToUpload:u,ineligibleFiles:null};},$8:function(s,t){var u=ss.arrayClone(this.state.filesToIgnore);var v=[];_.each(s,function(w){if(t!==5){u.push(w.name);}v.push(w.name);});this.setState({fatalErrorType:t,filesToIgnore:u,recentlyIgnoredFiles:v});},$5:function(){return ss.isValue(this.props.uploadOrProcessingFailedFiles)&&this.props.uploadOrProcessingFailedFiles.length>0;},$6:function(s,t){_.each(s,function(u){tab.FileUploadTelemetry.getInstance().logFileUploadFailureEvent(q.$1[u.name],t);});}});var r=global.tab.UploadFileContainer=ss.mkType(a,'tab.UploadFileContainer',function(s){React.Component.call(this,s);this.state={currentActionMessage:null,done:false,processing:false};},{render:function(){var s={currentActionMessage:this.state.currentActionMessage,dismiss:this.props.dismiss,done:this.state.done,uploadOrProcessingFailedFiles:this.state.failedFiles,uploadOrProcessingFailureReasons:this.state.failureReasons,files:this.props.files,key:this.props.files.length,maxFileSize:this.props.maxFileSize,onFileUploadFinished:this.props.onFileUploadFinished,onAllFileUploadsFinished:this.props.onAllFileUploadsFinished,isProcessing:this.state.processing};return React.createElement(n,{dismiss:this.props.dismiss},React.createElement(q,s));}});ss.initClass(b);ss.initClass(c);ss.initClass(d,spiff.PureRenderComponent);ss.initClass(e,d);ss.initClass(g);ss.initClass(h);ss.initClass(i);ss.initClass(j,null,[tab.IFileUploadModule]);ss.initClass(k,spiff.PureRenderComponent);ss.initClass(l,spiff.PureRenderComponent);ss.initClass(n,React.Component);ss.initClass(o,ss.makeGenericType(m,[Object]));ss.initClass(p);ss.initClass(q,React.Component);ss.initClass(r,React.Component);(function(){b.$1=1024;b.$2=1024*1024;b.$0=1048576*1024;})();(function(){g.allSupportedFileExtensions=null;var s=[];s.push.apply(s,g.getFileExtensionsForConnectionType('excel-direct'));s.push.apply(s,g.getFileExtensionsForConnectionType('textscan'));s.push.apply(s,g.getFileExtensionsForConnectionType('ogrdirect'));g.allSupportedFileExtensions=s;})();(function(){n.$0='tabUploadProgressDialog';})();(function(){q.$1={};})();})();// END FileUploadModule
